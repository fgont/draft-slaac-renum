<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Improving the Reaction of Customer Edge Routers to IPv6 Renumbering Events</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Requirements Language">
<link href="#rfc.section.3" rel="Chapter" title="3 Improved Customer Edge Router Behavior">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Automatic DHCPv6 RELEASEs">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Stability of IAIDs">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Interface Between WAN-side and LAN-side">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 LAN-side Option Lifetimes">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Signaling Stale Configuration Information">
<link href="#rfc.section.4" rel="Chapter" title="4 Recommended Option Lifetimes Configuration Values">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 3.5.0 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Gont, F., Zorz, J., Patterson, R., and B. Volz" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-v6ops-cpe-slaac-renum-07" />
  <meta name="dct.issued" scheme="ISO8601" content="2021-11" />
  <meta name="dct.abstract" content="This document specifies improvements to Customer Edge Routers that help mitigate the problems that may arise when network configuration information becomes invalid, without any explicit signaling of that condition to the affected nodes. This document updates RFC7084.   " />
  <meta name="description" content="This document specifies improvements to Customer Edge Routers that help mitigate the problems that may arise when network configuration information becomes invalid, without any explicit signaling of that condition to the affected nodes. This document updates RFC7084.   " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">IPv6 Operations Working Group (v6ops)</td>
<td class="right">F. Gont</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">SI6 Networks</td>
</tr>
<tr>
<td class="left">Updates: 7084 (if approved)</td>
<td class="right">J. Zorz</td>
</tr>
<tr>
<td class="left">Intended status: Best Current Practice</td>
<td class="right">6connect</td>
</tr>
<tr>
<td class="left">Expires: August 15, 2021</td>
<td class="right">R. Patterson</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Sky UK</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">B. Volz</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Cisco</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">February 11, 2021</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Improving the Reaction of Customer Edge Routers to IPv6 Renumbering Events<br />
  <span class="filename">draft-ietf-v6ops-cpe-slaac-renum-07</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies improvements to Customer Edge Routers that help mitigate the problems that may arise when network configuration information becomes invalid, without any explicit signaling of that condition to the affected nodes. This document updates RFC7084.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 15, 2021.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2021 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Requirements Language</a>
</li>
<li>3.   <a href="#rfc.section.3">Improved Customer Edge Router Behavior</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Automatic DHCPv6 RELEASEs</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Stability of IAIDs</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Interface Between WAN-side and LAN-side</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">LAN-side Option Lifetimes</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Signaling Stale Configuration Information</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Recommended Option Lifetimes Configuration Values</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Acknowledgments</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<ul><li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">In scenarios where network configuration information becomes invalid without any explicit signaling of that condition (such as when a Customer Edge Router crashes and reboots without knowledge of the previously-employed configuration information), hosts on the local network will continue using stale information for an unacceptably long period of time, thus resulting in connectivity problems. This problem is documented in detail in <a href="#I-D.ietf-v6ops-slaac-renum" class="xref">[I-D.ietf-v6ops-slaac-renum]</a>.</p>
<p id="rfc.section.1.p.2">This document specifies improvements to Customer Edge (CE) Routers that help mitigate the aforementioned problem for residential and small office scenarios. It specifies recommendations for the default behavior of CE Routers, and does not preclude the availability of configuration knobs that might allow an operator or user to manually-configure the CE Router to deviate from these recommendations. This document updates RFC7084.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#reqs-language" id="reqs-language">Requirements Language</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#CPE" id="CPE">Improved Customer Edge Router Behavior</a>
</h1>
<p id="rfc.section.3.p.1">This section specifies and clarifies requirements for Customer Edge Routers that can help mitigate the problem discussed in <a href="#intro" class="xref">Section 1</a>, particularly when they employ prefixes learned via DHCPv6-Prefix Delegation (DHCPv6-PD) <a href="#RFC8415" class="xref">[RFC8415]</a> on the WAN-side with Stateless Address Autoconfiguration (SLAAC) <a href="#RFC4862" class="xref">[RFC4862]</a> or DHCPv6 <a href="#RFC8415" class="xref">[RFC8415]</a> on the LAN-side. The recommendations in this document help improve robustness at the Customer Edge Router (on which the user or ISP may have no control), and do not preclude implementation of host-side improvements such as those specified in <a href="#I-D.ietf-6man-slaac-renum" class="xref">[I-D.ietf-6man-slaac-renum]</a>.</p>
<p id="rfc.section.3.p.2">This document specifies additional prefix-delegation requirements to those specified in <a href="#RFC7084" class="xref">[RFC7084]</a>: </p>

<ul>
<li>WPD-9: CE routers SHOULD NOT automatically send DHCPv6-PD RELEASE messages upon reboot events. See <a href="#dhcpv6-release" class="xref">Section 3.1</a> for further details.</li>
<li>WPD-10: CE Routers MUST by default use a stable IAID value that does not change between CE Router restarts, DHCPv6 client restarts, or interface state changes. e.g., Transient PPP interfaces. See <a href="#dhcpv6-iaid" class="xref">Section 3.2</a> for further details.</li>
</ul>

<p> </p>
<p id="rfc.section.3.p.3">This document also replaces LAN-side requirement L-13 from <a href="#RFC7084" class="xref">[RFC7084]</a> with: </p>

<ul><li>L-13: CE routers MUST signal stale configuration information as specified in <a href="#sig-stale-config" class="xref">Section 3.5</a>.</li></ul>

<p> </p>
<p id="rfc.section.3.p.4">Finally, this document specifies the following additional LAN-side requirements to those from <a href="#RFC7084" class="xref">[RFC7084]</a>: </p>

<ul>
<li>L-15: CE routers MUST NOT advertise prefixes via SLAAC or assign addresses or delegate prefixes via DHCPv6 on the LAN-side, employing lifetimes that exceed the remaining lifetimes of the corresponding prefixes learned from the WAN-side via DHCPv6-PD. For more details, see <a href="#dhcpv6-pd-slaac" class="xref">Section 3.3</a>.</li>
<li>L-16: CE routers SHOULD advertise capped SLAAC option lifetimes and capped DHCPv6 IA Address Option and IA Prefix Option lifetimes, as specified in <a href="#lan-lifetimes" class="xref">Section 3.4</a>.</li>
</ul>

<p> </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#dhcpv6-release" id="dhcpv6-release">Automatic DHCPv6 RELEASEs</a>
</h1>
<p id="rfc.section.3.1.p.1">Some CE Routers are known to automatically send DHCPv6-PD RELEASE messages upon reboot events. However, this may inadvertently trigger a flash-renumbering scenario, along with the associated problems discussed in <a href="#I-D.ietf-v6ops-slaac-renum" class="xref">[I-D.ietf-v6ops-slaac-renum]</a>, that this document attempts to mitigate.  </p>
<p id="rfc.section.3.1.p.2">As a result, requirement WPD-9 from <a href="#CPE" class="xref">Section 3</a> specifies that CE routers SHOULD NOT automatically send DHCPv6-PD RELEASE messages upon reboot events.  </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#dhcpv6-iaid" id="dhcpv6-iaid">Stability of IAIDs</a>
</h1>
<p><a href="#RFC8415" class="xref">[RFC8415]</a> requires that the IAID for an IA MUST be consistent across restarts of the DHCP client. However, some popular CE Routers are known to select new random IAIDs e.g. everytime the underlying PPP session is established. This could be the result of extrapolating the behavior described in <a href="#RFC7844" class="xref">[RFC7844]</a>, or simply a consequence of not storing IAIDs on stable storage along with failing to employ an algorithm that consistently generates the same IAID upon reboots. Thus, requirement WPD-10 from <a href="#CPE" class="xref">Section 3</a> prevents CE Routers from inadvertently triggering flash-renumbering events on the local network.  </p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#dhcpv6-pd-slaac" id="dhcpv6-pd-slaac">Interface Between WAN-side and LAN-side</a>
</h1>
<p id="rfc.section.3.3.p.1">The "Preferred Lifetime" and "Valid Lifetime" of Prefix Information Options (PIOs) <a href="#RFC4861" class="xref">[RFC4861]</a> corresponding to prefixes learned via DHCPv6-PD MUST NOT span past the remaining preferred and valid lifetimes of the corresponding DHCPv6-PD prefixes. This means that the "Preferred Lifetime" and the "Valid Lifetime" advertised in PIOs by the CE router MUST be dynamically adjusted such that they never span past the remaining preferred and valid lifetimes of the corresponding prefixes delegated via DHCPv6-PD on the WAN-side.</p>
<p id="rfc.section.3.3.p.2">Similarly, the "preferred-lifetime" and "valid-lifetime" of DHCPv6 IA Address Options and DHCPv6 IA Prefix Options employed with DHCPv6 on the LAN-side MUST NOT span past the remaining preferred and valid lifetimes of the corresponding prefixes leased via DHCPv6-PD on the WAN-side. This means that the "preferred-lifetime" and "valid-lifetime" of DHCPv6 IA Address Options and DHCPv6 IA Prefix Options employed with DHCPv6 on the LAN-side MUST be dynamically adjusted such that they never span past the remaining preferred and valid lifetimes of the corresponding prefixes delegated to the CE router on the WAN-side via DHCPv6-PD.</p>
<p></p>

<dl>
<dt>RATIONALE:</dt>
<dd style="margin-left: 8">
<ul>
<li>The lifetime values employed for the "Preferred Lifetime" (AdvPreferredLifetime) and "Valid Lifetime" (AdvValidLifetime) of SLAAC Prefix Information Options must never be larger than the remaining lifetimes for the corresponding prefix (as learned via DHCPv6-PD on the WAN-side). This is in line with the requirement from Section 6.3 of <a href="#RFC8415" class="xref">[RFC8415]</a>, which states that "if the delegated prefix or a prefix derived from it is advertised for stateless address autoconfiguration <a href="#RFC4862" class="xref">[RFC4862]</a>, the advertised preferred and valid lifetimes MUST NOT exceed the corresponding remaining lifetimes of the delegated prefix."</li>
<li>The lifetime values of prefixes advertised on the LAN-side via SLAAC must be dynamically updated (rather than static values), otherwise the advertised lifetimes would eventually span past the DHCPv6-PD lifetimes.</li>
<li>The same considerations apply for the valid-lifetime and preferred-lifetime of IA Address Options and IA Prefix Options employed with DHCPv6 on the LAN-side.</li>
</ul>
<p> </p>
</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#lan-lifetimes" id="lan-lifetimes">LAN-side Option Lifetimes</a>
</h1>
<p id="rfc.section.3.4.p.1">CE Routers SHOULD override the default lifetime values of Neighbor Discovery options that depend in any way on changes in the prefix employed for address configuration on the LAN-side, and employ shorter lifetime values to improve the robustness to renumbering events, while complying with the requirements from <a href="#dhcpv6-pd-slaac" class="xref">Section 3.3</a> of this document and the recommendations in <a href="#RFC7772" class="xref">[RFC7772]</a>.  </p>
<p id="rfc.section.3.4.p.2">CE Routers SHOULD set the Router Lifetime to ND_PREFERRED_LIMIT.</p>
<p id="rfc.section.3.4.p.3">CE Routers SHOULD also set the PIO Preferred Lifetime to the lesser of the remaining preferred lifetime (see <a href="#dhcpv6-pd-slaac" class="xref">Section 3.3</a>) and ND_PREFERRED_LIMIT, and the PIO Valid Lifetime to the lesser of the remaining valid lifetime and ND_VALID_LIMIT. Additionally, the Route Lifetime of Route Information Options (RIOs) <a href="#RFC4191" class="xref">[RFC4191]</a>, the Lifetime of Recursive DNS Search Options (RDNSSO) <a href="#RFC8106" class="xref">[RFC8106]</a>, and the Lifetime of DNS Search List Options (DNSSLO) <a href="#RFC8106" class="xref">[RFC8106]</a> SHOULD be set to the lesser of the longest valid-lifetime in a DHCPv6 IA Prefix Option (received via DHCPv6 on the WAN-side) and ND_VALID_LIMIT, if any of these options are included in Router Advertisement messages.  </p>

<dl>
<dt>NOTES:</dt>
<dd style="margin-left: 8">In scenarios where the valid-lifetime and the preferred-lifetime of the prefix leased via DHCPv6 on the WAN-side are always lower than ND_VALID_LIMIT and ND_PREFERRED_LIMIT, respectively, the lifetime values advertised on the LAN-side will see not experience actual changes.  </dd>
<dt></dt>
<dd style="margin-left: 8">The above text refers to the Neighbor Discovery Options that are typically employed by CE Routers. A CE Router may need to apply the same policy for setting the lifetime of other Neighbor Discovery options it employs, if and where applicable.  </dd>
</dl>

<p> </p>
<p id="rfc.section.3.4.p.4">CE Routers providing stateful address configuration via DHCPv6 SHOULD set the DHCPv6 IA Address Option preferred-lifetime to the lesser of the remaining preferred lifetime (see <a href="#dhcpv6-pd-slaac" class="xref">Section 3.3</a>) and ND_PREFERRED_LIMIT, and the valid-lifetime of the same option to the lesser of the remaining valid lifetime and ND_VALID_LIMIT.  </p>
<p id="rfc.section.3.4.p.5">CE Routers providing DHCPv6-PD on the LAN-side SHOULD set the DHCPv6 IA Prefix Option preferred-lifetime to the lesser of the remaining preferred lifetime (see <a href="#dhcpv6-pd-slaac" class="xref">Section 3.3</a>) and ND_PREFERRED_LIMIT, and the valid-lifetime of the same option to the lesser of the remaining valid lifetime and ND_VALID_LIMIT.  </p>
<p></p>

<dl>
<dt>RATIONALE:</dt>
<dd style="margin-left: 8">
<ul>
<li>The Valid Lifetime and Preferred Lifetime of PIOs have a direct impact on three different aspects: <ul>
<li>The amount of time hosts may end up employing stale network configuration information (see <a href="#I-D.ietf-v6ops-slaac-renum" class="xref">[I-D.ietf-v6ops-slaac-renum]</a>).</li>
<li>The amount of time CE Routers need to persist trying to deprecate stale network configuration information (e.g. to handle cases where hosts miss Router Advertisements and thus still consider the stale information as valid).</li>
<li>The amount of information that CE Routers need to maintain when e.g. multiple crash-and-reboot events occur in the timespan represented by the option lifetimes employed on the LAN-side.</li>
</ul>
<p> </p>
</li>
<li>CE Routers need not employ the (possibly long) WAN-side DHCPv6-PD lifetimes for the Valid Lifetime and Preferred Lifetime of PIOs sent in Router Advertisements messages to advertise sub-prefixes of the leased prefix. Instead, CE Routers SHOULD use shorter values for the Valid Lifetime and Preferred Lifetime of PIOs, since subsequent Router Advertisement messages will nevertheless refresh the associated lifetimes, leading to the same effective lifetimes as specified by the WAN-side DHCPv6-PD lifetimes.  </li>
<li>Similarly, CE Routers need not employ the (possibly long) WAN-side DHCPv6-PD lifetimes for the valid-lifetime and preferred-lifetime of IA Address Options and IA Prefix Option employed by DHCPv6 on the LAN-side, since the renewal of bindings by DHCPv6 clients will lead to the same effective lifetimes as specified by the WAN-side DHCPv6-PD lifetimes.  </li>
</ul>
<p> </p>
</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#sig-stale-config" id="sig-stale-config">Signaling Stale Configuration Information</a>
</h1>
<p id="rfc.section.3.5.p.1">If a CE Router provides LAN-side address-configuration information via SLAAC: </p>

<ul>
<li>A CE Router sending RAs that advertise dynamically-learned prefixes (e.g. via DHCPv6-PD) SHOULD record, on stable storage, the list of prefixes being advertised via PIOs on each network segment, and the state of the "A" and "L" flags of the corresponding PIOs.</li>
<li>Upon changes to the advertised prefixes, and after bootstrapping, the CE Router advertising prefix information via SLAAC proceeds as follows: <ul>
<li>Any prefixes that were previously advertised by the CE Router via PIOs in RA messages, but that have now become stale, MUST be advertised with a PIO that has the "Valid Lifetime" and the "Preferred Lifetime" set to 0, and the "A" and "L" bits unchanged.  </li>
<li>The aforementioned advertisement MUST be performed for at least the "Valid Lifetime" previously employed for such prefix. The CE Router MUST advertise this information with unsolicited Router Advertisements as described in Section 6.2.4 of <a href="#RFC4861" class="xref">[RFC4861]</a>, and MAY advertise this information via unicast Router Advertisements when possible and applicable.  <ul><li>Note: If requirement L-16 (<a href="#lan-lifetimes" class="xref">Section 3.4</a>) is followed, the Valid Lifetime need not be saved and the stale prefix can simply be advertised for a period of ND_VALID_LIMIT.</li></ul>
<p> </p>
</li>
</ul>
<p> </p>
</li>
<li>CE Routers receiving DHCPv6 Prefix Delegations with a 0 valid-lifetime MUST advertise the corresponding sub-prefixes (as they would be generated for the same leased prefix with a non-zero lifetime) with a PIO with both the Preferred Lifetime and the Valid Lifetime set to 0, for at least the WAN-side DHCPv6-PD valid-lifetime, or for a period of ND_VALID_LIMIT if the recommended lifetimes from <a href="#lan-lifetimes" class="xref">Section 3.4</a> are employed.</li>
</ul>

<p> </p>
<p id="rfc.section.3.5.p.2">If a CE Router provides LAN-side DHCPv6 (address assignment or prefix delegation), then: </p>

<ul>
<li>The CE Router SHOULD record, on stable storage, the DHCPv6 address and delegated-prefix bindings corresponding to the LAN-side.</li>
<li>If the CE Router finds that the prefix to be employed for address assignment and/or prefix delegation has changed (e.g., upon a crash-and-reboot event) or the CE Router receives DHCPv6 Prefix Delegations with 0 lifetimes, the CE Router MUST: <ul>
<li>In Replies to DHCPv6 Request, Renew, and Rebind messages, send IA Address Options or IA Prefix Options (as appropriate) for any address assignments or prefix delegations for the deprecated prefixes. The aforementioned options MUST be sent with both the valid-lifetime and the preferred-lifetime set to 0, for at least the valid-lifetime originally employed for them, or for a period of ND_VALID_LIMIT if the recommended lifetimes from <a href="#lan-lifetimes" class="xref">Section 3.4</a> are employed.  </li>
<li>Initiate sending Reconfigure messages (if possible - i.e., client requests Reconfigure support and the CE Router offers it) to those clients with address assignments or prefix delegations for the deprecated prefixes.  </li>
</ul>
<p> </p>
</li>
</ul>

<p> </p>
<p></p>

<dl>
<dt>RATIONALE:</dt>
<dd style="margin-left: 8">
<ul>
<li>IPv6 network renumbering is expected to take place in a planned manner, with old/stale prefixes being phased-out via reduced prefix lifetimes while new prefixes (with normal lifetimes) are introduced. However, a number of scenarios may lead to the so-called "flash-renumbering" events, where the prefix being employed on a network suddenly becomes invalid and replaced by a new prefix <a href="#I-D.ietf-v6ops-slaac-renum" class="xref">[I-D.ietf-v6ops-slaac-renum]</a>. One such scenario is when a DHCPv6 server employs dynamic prefixes and the Customer Edge Router crashes and reboots. The requirements in this section are meant to allow Customer Edge Routers to deprecate stale information in such scenarios.  </li>
<li>The recommendations in this section expand from requirement L-13 in Section 4.3 of <a href="#RFC7084" class="xref">[RFC7084]</a>, and Section 6.3 of <a href="#RFC8415" class="xref">[RFC8415]</a>.</li>
<li>Host configuring addresses via SLAAC on the local network may employ addresses configured for the previously advertised prefixes for at most the "Valid Lifetime" of the corresponding PIO of the last received Router Advertisement message. Since Router Advertisement messages may be lost or fail to be received for various reasons, Customer Edge Routers need to try to deprecate stale prefixes for a period of time equal to the "Valid Lifetime" of the PIO employed when originally advertising the prefix.</li>
<li>The requirement in this section is conveyed as a "SHOULD" (as opposed to a "MUST"), since the requirement to store information on stable storage may represent a challenge for some implementations.</li>
<li>Advertising DHCPv6-leased prefixes with zero lifetimes on the LAN-side would handle the case where a CE Router has no stable storage but receives the prefixes via DHCPv6 with 0 lifetimes.</li>
<li>The above text does not include DHCPv6 Advertise messages sent in response to DHCPv6 Solicit messages, since Section 18.3.9 of <a href="#RFC8415" class="xref">[RFC8415]</a> requires that a DHCPv6 server that is not going to assign an address or delegated prefix received as a hint in the Solicit message MUST NOT include that address or delegated prefix in the Advertise message. Additionally, any subsequent Request messages will trigger the response specified in this section, and therefore cause the address or prefix to be deprecated.</li>
</ul>
<p> </p>
</dd>
</dl>

<p> </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#parameters" id="parameters">Recommended Option Lifetimes Configuration Values</a>
</h1>
<p></p>

<ul>
<li>ND_PREFERRED_LIMIT: 2700 seconds (45 minutes)</li>
<li>ND_VALID_LIMIT: 5400 seconds (90 minutes)</li>
</ul>

<p> </p>
<p></p>

<dl>
<dt>RATIONALE:</dt>
<dd style="margin-left: 8">
<br> These values represent a trade-off among a number of factors, including responsiveness and possible impact on the battery life of connected devices <a href="#RFC7772" class="xref">[RFC7772]</a>.  </dd>
<dt></dt>
<dd style="margin-left: 8">ND_PREFERRED_LIMIT is set according to the recommendations in <a href="#RFC7772" class="xref">[RFC7772]</a> for Router Lifetime, following the rationale from Section 3.2 of <a href="#I-D.ietf-v6ops-slaac-renum" class="xref">[I-D.ietf-v6ops-slaac-renum]</a>.</dd>
<dt></dt>
<dd style="margin-left: 8">ND_VALID_LIMIT is set to 2 * ND_PREFERRED_LIMIT to provide some additional leeway before configuration information is finally discarded by the host.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> IANA Considerations</h1>
<p id="rfc.section.5.p.1">This document has no actions for IANA.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Security Considerations</h1>
<p id="rfc.section.6.p.1">This document discusses a problem that may arise in scenarios where dynamic IPv6 prefixes are employed, and proposes improvements to Customer Edge Routers <a href="#RFC7084" class="xref">[RFC7084]</a> to mitigate the problem for residential or small office scenarios. It does not introduce new security issues, and thus the same security considerations as for <a href="#RFC4861" class="xref">[RFC4861]</a>, <a href="#RFC4862" class="xref">[RFC4862]</a>, <a href="#RFC7084" class="xref">[RFC7084]</a>, and <a href="#RFC8415" class="xref">[RFC8415]</a> apply.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Acknowledgments</h1>
<p id="rfc.section.7.p.1">The authors would like to thank Owen DeLong, Philip Homburg, and Ted Lemon, for their valuable help in improving this document via successive detailed reviews.  </p>
<p id="rfc.section.7.p.2">The authors would like to thank Mikael Abrahamsson, Luis Balbinot, Tim Chown, Brian Carpenter, Lorenzo Colitti, Alejandro D'Egidio, Gert Doering, Fernando Frediani, Guillermo Gont, Steinar Haug, Nick Hilliard, Lee Howard, Christian Huitema, Sheng Jiang, Benjamin Kaduk, Erik Kline, Suresh Krishnan, Warren Kumari, Albert Manfredi, Olorunloba Olopade, Jordi Palet Martinez, Richard Patterson, Pete Resnick, Michael Richardson, Mark Smith, Job Snijders, Sander Steffann, Tarko Tikan, Ole Troan, Loganaden Velvindron, Eric Vyncke, Robert Wilton, Timothy Winters, Christopher Wood, and Chongfeng Xie, for providing valuable comments on earlier versions of this document.</p>
<p id="rfc.section.7.p.3">Fernando would also like to thank Brian Carpenter who, over the years, has answered many questions and provided valuable comments that have benefited his protocol-related work.</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4191">[RFC4191]</b></td>
<td class="top">
<a>Draves, R.</a> and <a>D. Thaler</a>, "<a href="https://tools.ietf.org/html/rfc4191">Default Router Preferences and More-Specific Routes</a>", RFC 4191, DOI 10.17487/RFC4191, November 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4861">[RFC4861]</b></td>
<td class="top">
<a>Narten, T.</a>, <a>Nordmark, E.</a>, <a>Simpson, W.</a> and <a>H. Soliman</a>, "<a href="https://tools.ietf.org/html/rfc4861">Neighbor Discovery for IP version 6 (IPv6)</a>", RFC 4861, DOI 10.17487/RFC4861, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4862">[RFC4862]</b></td>
<td class="top">
<a>Thomson, S.</a>, <a>Narten, T.</a> and <a>T. Jinmei</a>, "<a href="https://tools.ietf.org/html/rfc4862">IPv6 Stateless Address Autoconfiguration</a>", RFC 4862, DOI 10.17487/RFC4862, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7772">[RFC7772]</b></td>
<td class="top">
<a>Yourtchenko, A.</a> and <a>L. Colitti</a>, "<a href="https://tools.ietf.org/html/rfc7772">Reducing Energy Consumption of Router Advertisements</a>", BCP 202, RFC 7772, DOI 10.17487/RFC7772, February 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7844">[RFC7844]</b></td>
<td class="top">
<a>Huitema, C.</a>, <a>Mrugalski, T.</a> and <a>S. Krishnan</a>, "<a href="https://tools.ietf.org/html/rfc7844">Anonymity Profiles for DHCP Clients</a>", RFC 7844, DOI 10.17487/RFC7844, May 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8106">[RFC8106]</b></td>
<td class="top">
<a>Jeong, J.</a>, <a>Park, S.</a>, <a>Beloeil, L.</a> and <a>S. Madanapalli</a>, "<a href="https://tools.ietf.org/html/rfc8106">IPv6 Router Advertisement Options for DNS Configuration</a>", RFC 8106, DOI 10.17487/RFC8106, March 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8415">[RFC8415]</b></td>
<td class="top">
<a>Mrugalski, T.</a>, <a>Siodelski, M.</a>, <a>Volz, B.</a>, <a>Yourtchenko, A.</a>, <a>Richardson, M.</a>, <a>Jiang, S.</a>, <a>Lemon, T.</a> and <a>T. Winters</a>, "<a href="https://tools.ietf.org/html/rfc8415">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>", RFC 8415, DOI 10.17487/RFC8415, November 2018.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-6man-slaac-renum">[I-D.ietf-6man-slaac-renum]</b></td>
<td class="top">
<a>Gont, F.</a>, <a>Zorz, J.</a> and <a>R. Patterson</a>, "<a href="https://tools.ietf.org/html/draft-ietf-6man-slaac-renum-02">Improving the Robustness of Stateless Address Autoconfiguration (SLAAC) to Flash Renumbering Events</a>", Internet-Draft draft-ietf-6man-slaac-renum-02, January 2021.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-v6ops-slaac-renum">[I-D.ietf-v6ops-slaac-renum]</b></td>
<td class="top">
<a>Gont, F.</a>, <a>Zorz, J.</a> and <a>R. Patterson</a>, "<a href="https://tools.ietf.org/html/draft-ietf-v6ops-slaac-renum-05">Reaction of Stateless Address Autoconfiguration (SLAAC) to Flash- Renumbering Events</a>", Internet-Draft draft-ietf-v6ops-slaac-renum-05, November 2020.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7084">[RFC7084]</b></td>
<td class="top">
<a>Singh, H.</a>, <a>Beebee, W.</a>, <a>Donley, C.</a> and <a>B. Stark</a>, "<a href="https://tools.ietf.org/html/rfc7084">Basic Requirements for IPv6 Customer Edge Routers</a>", RFC 7084, DOI 10.17487/RFC7084, November 2013.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Fernando Gont</span> 
	  <span class="n hidden">
		<span class="family-name">Gont</span>
	  </span>
	</span>
	<span class="org vcardline">SI6 Networks</span>
	<span class="adr">
	  <span class="vcardline">Segurola y Habana 4310, 7mo Piso</span>

	  <span class="vcardline">
		<span class="locality">Villa Devoto</span>,  
		<span class="region">Ciudad Autonoma de Buenos Aires</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Argentina</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:fgont@si6networks.com">fgont@si6networks.com</a></span>

<span class="vcardline">URI: <a href="https://www.si6networks.com">https://www.si6networks.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jan Zorz</span> 
	  <span class="n hidden">
		<span class="family-name">Zorz</span>
	  </span>
	</span>
	<span class="org vcardline">6connect</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jan@6connect.com">jan@6connect.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Richard Patterson</span> 
	  <span class="n hidden">
		<span class="family-name">Patterson</span>
	  </span>
	</span>
	<span class="org vcardline">Sky UK</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:richard.patterson@sky.uk">richard.patterson@sky.uk</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Bernie Volz</span> 
	  <span class="n hidden">
		<span class="family-name">Volz</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span class="vcardline">300 Beaver Brook Rd</span>

	  <span class="vcardline">
		<span class="locality">Boxborough, MA 01719</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:volz@cisco.com">volz@cisco.com</a></span>

  </address>
</div>

</body>
</html>
